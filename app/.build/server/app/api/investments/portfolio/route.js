"use strict";(()=>{var e={};e.id=410,e.ids=[410],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},21:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>f,patchFetch:()=>g,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>v});var s={};a.r(s),a.d(s,{GET:()=>p,dynamic:()=>u});var n=a(3277),r=a(5265),o=a(5356),i=a(7076),l=a(6059);let u="force-dynamic";async function p(){try{let e=await l.db.investment.findMany({where:{isActive:!0},include:{transactions:!0}}),t=0,a=0,s=e.length,n={},r={};e.forEach(e=>{t+=e.totalInvested,a+=e.currentValue,n[e.assetClass]||(n[e.assetClass]={assetClass:e.assetClass,value:0,invested:0,count:0}),n[e.assetClass].value+=e.currentValue,n[e.assetClass].invested+=e.totalInvested,n[e.assetClass].count+=1,r[e.platform]||(r[e.platform]={platform:e.platform,value:0,investmentCount:0}),r[e.platform].value+=e.currentValue,r[e.platform].investmentCount+=1});let o=a-t,u=t>0?o/t*100:0,p=Object.values(n).map(e=>({...e,percentage:a>0?e.value/a*100:0,gainLoss:e.value-e.invested,gainLossPercentage:e.invested>0?(e.value-e.invested)/e.invested*100:0})),d=Object.values(r).map(e=>({...e,percentage:a>0?e.value/a*100:0})),c={totalInvestments:s,totalInvested:t,currentValue:a,totalGainLoss:o,totalGainLossPercentage:u,dayGainLoss:0,dayGainLossPercentage:0};return i.NextResponse.json({stats:c,assetAllocation:p,platformAllocation:d,investments:e.map(e=>({investmentId:e.id,name:e.name,assetClass:e.assetClass,invested:e.totalInvested,currentValue:e.currentValue,gainLoss:e.currentValue-e.totalInvested,gainLossPercentage:e.totalInvested>0?(e.currentValue-e.totalInvested)/e.totalInvested*100:0,dayChange:0,dayChangePercentage:0}))})}catch(e){return console.error("Error fetching portfolio data:",e),i.NextResponse.json({error:"Failed to fetch portfolio data"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/investments/portfolio/route",pathname:"/api/investments/portfolio",filename:"route",bundlePath:"app/api/investments/portfolio/route"},resolvedPagePath:"/home/ubuntu/moneymitra/app/app/api/investments/portfolio/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:v,serverHooks:m}=d,f="/api/investments/portfolio/route";function g(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:v})}},6059:(e,t,a)=>{a.d(t,{_:()=>n,db:()=>r});var s=a(3524);let n=globalThis.prisma??new s.PrismaClient,r=n}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[5942,3786],()=>a(21));module.exports=s})();