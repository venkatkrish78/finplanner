"use strict";(()=>{var e={};e.id=4515,e.ids=[4515],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5834:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>v,staticGenerationAsyncStorage:()=>m});var a={};n.r(a),n.d(a,{GET:()=>u,dynamic:()=>l});var s=n(921),r=n(7380),i=n(4185),o=n(3878),c=n(2334);let l="force-dynamic";async function u(){try{let e=await c.db.investment.findMany({where:{isActive:!0},include:{transactions:{orderBy:{date:"asc"}}}}),t={},n=new Date;for(let e=11;e>=0;e--){let a=new Date(n.getFullYear(),n.getMonth()-e,1);t[a.toISOString().slice(0,7)]={month:a.toLocaleDateString("en-US",{month:"short",year:"numeric"}),invested:0,value:0,gainLoss:0}}e.forEach(e=>{let n=0;e.transactions.forEach(e=>{let a=new Date(e.date).toISOString().slice(0,7);"BUY"===e.type||"SIP_INSTALLMENT"===e.type?n+=e.amount:"SELL"===e.type&&(n-=e.amount),Object.keys(t).forEach(n=>{n>=a&&("BUY"===e.type||"SIP_INSTALLMENT"===e.type?t[n].invested+=e.amount:"SELL"===e.type&&(t[n].invested-=e.amount))})})}),Object.keys(t).forEach(e=>{let n=t[e];n.value=1.1*n.invested,n.gainLoss=n.value-n.invested});let a=Object.values(t),s=e.map(e=>({investmentId:e.id,name:e.name,assetClass:e.assetClass,invested:e.totalInvested,currentValue:e.currentValue,gainLoss:e.currentValue-e.totalInvested,gainLossPercentage:e.totalInvested>0?(e.currentValue-e.totalInvested)/e.totalInvested*100:0,dayChange:0,dayChangePercentage:0})),r=s.sort((e,t)=>t.gainLossPercentage-e.gainLossPercentage).slice(0,5),i=s.sort((e,t)=>e.gainLossPercentage-t.gainLossPercentage).slice(0,5);return o.NextResponse.json({monthlyPerformance:a,topPerformers:r,worstPerformers:i})}catch(e){return console.error("Error fetching investment analytics:",e),o.NextResponse.json({error:"Failed to fetch investment analytics"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/investments/analytics/route",pathname:"/api/investments/analytics",filename:"route",bundlePath:"app/api/investments/analytics/route"},resolvedPagePath:"/home/ubuntu/moneymitra/app/app/api/investments/analytics/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:v}=d,g="/api/investments/analytics/route";function y(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:m})}},2334:(e,t,n)=>{n.d(t,{db:()=>r,_:()=>s});let a=require("@prisma/client"),s=globalThis.prisma??new a.PrismaClient,r=s}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),a=t.X(0,[5923,7146],()=>n(5834));module.exports=a})();