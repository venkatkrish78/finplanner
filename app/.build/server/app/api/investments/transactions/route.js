"use strict";(()=>{var e={};e.id=4484,e.ids=[4484],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5011:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>y,staticGenerationAsyncStorage:()=>v});var a={};n.r(a),n.d(a,{GET:()=>d,POST:()=>p,dynamic:()=>c});var r=n(921),s=n(7380),i=n(4185),o=n(3878),u=n(9958);let c="force-dynamic";async function d(e){try{let{searchParams:t}=new URL(e.url),n=t.get("investmentId"),a=t.get("type"),r={};n&&(r.investmentId=n),a&&(r.type=a);let s=await u.db.investmentTransaction.findMany({where:r,include:{investment:{select:{id:!0,name:!0,assetClass:!0}}},orderBy:{date:"desc"}});return o.NextResponse.json(s)}catch(e){return console.error("Error fetching investment transactions:",e),o.NextResponse.json({error:"Failed to fetch investment transactions"},{status:500})}}async function p(e){try{let{investmentId:t,type:n,quantity:a,price:r,fees:s=0,tax:i=0,date:c,notes:d}=await e.json(),p=a*r,l=await u.db.investmentTransaction.create({data:{investmentId:t,type:n,quantity:a,price:r,amount:p,fees:s,tax:i,date:new Date(c),notes:d}}),m=await u.db.investment.findUnique({where:{id:t}});if(m){let e=m.quantity,r=m.totalInvested,s=m.averagePrice;if("BUY"===n||"SIP_INSTALLMENT"===n){let t=m.quantity*m.averagePrice+p;e=m.quantity+a,r=m.totalInvested+p,s=e>0?t/e:0}else if("SELL"===n){e=Math.max(0,m.quantity-a);let t=a/m.quantity;r=m.totalInvested*(1-t)}let i=e*m.currentPrice;await u.db.investment.update({where:{id:t},data:{quantity:e,totalInvested:r,averagePrice:s,currentValue:i}})}return o.NextResponse.json(l,{status:201})}catch(e){return console.error("Error creating investment transaction:",e),o.NextResponse.json({error:"Failed to create investment transaction"},{status:500})}}let l=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/investments/transactions/route",pathname:"/api/investments/transactions",filename:"route",bundlePath:"app/api/investments/transactions/route"},resolvedPagePath:"/home/ubuntu/moneymitra/app/app/api/investments/transactions/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:v,serverHooks:y}=l,h="/api/investments/transactions/route";function g(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:v})}},9958:(e,t,n)=>{n.d(t,{_:()=>r,db:()=>s});var a=n(3524);let r=globalThis.prisma??new a.PrismaClient,s=r}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),a=t.X(0,[5923,7146],()=>n(5011));module.exports=a})();