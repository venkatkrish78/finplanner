"use strict";(()=>{var e={};e.id=4094,e.ids=[4094],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4304:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>v,staticGenerationAsyncStorage:()=>g});var a={};n.r(a),n.d(a,{GET:()=>c,POST:()=>p,dynamic:()=>u});var r=n(921),s=n(7380),o=n(4185),i=n(3878),l=n(2334);let u="force-dynamic";async function c(e){try{let{searchParams:t}=new URL(e.url),n=t.get("goalId"),a=t.get("assetClass"),r=t.get("platform"),s=t.get("isActive"),o="true"===t.get("includeGoals"),u={};n&&(u.goalId=n),a&&(u.assetClass=a),r&&(u.platform=r),null!==s&&(u.isActive="true"===s);let c=(await l._.investment.findMany({where:u,include:{goal:o?{select:{id:!0,name:!0,goalType:!0,targetAmount:!0,currentAmount:!0}}:void 0,goalLinks:o?{include:{goal:{select:{id:!0,name:!0,goalType:!0,targetAmount:!0,currentAmount:!0}}}}:void 0,category:!0},orderBy:{updatedAt:"desc"}})).map(e=>{let t=[];return o&&e.goal&&t.push({...e.goal,allocation:100,linkType:"direct"}),o&&e.goalLinks&&e.goalLinks.forEach(e=>{e.goal&&t.push({...e.goal,allocation:e.allocation,linkType:"linked",linkId:e.id})}),{...e,linkedGoals:t}});return i.NextResponse.json(c)}catch(e){return console.error("Error fetching investments:",e),i.NextResponse.json({error:"Failed to fetch investments"},{status:500})}}async function p(e){try{let{name:t,symbol:n,assetClass:a,platform:r,quantity:s,purchasePrice:o,currentPrice:u,purchaseDate:c,description:p,goalId:d,categoryId:m}=await e.json(),g=s*o,v=await l._.investment.create({data:{name:t,symbol:n,assetClass:a,platform:r,quantity:s,averagePrice:o,currentPrice:u,totalInvested:g,currentValue:s*u,purchaseDate:c?new Date(c):null,description:p,goalId:d||null,categoryId:m||null}});return s>0&&o>0&&await l._.investmentTransaction.create({data:{investmentId:v.id,type:"BUY",quantity:s,price:o,amount:g,date:c?new Date(c):new Date,notes:"Initial purchase"}}),i.NextResponse.json(v,{status:201})}catch(e){return console.error("Error creating investment:",e),i.NextResponse.json({error:"Failed to create investment"},{status:500})}}let d=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/investments/route",pathname:"/api/investments",filename:"route",bundlePath:"app/api/investments/route"},resolvedPagePath:"/home/ubuntu/moneymitra/app/app/api/investments/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:v}=d,h="/api/investments/route";function y(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:g})}},2334:(e,t,n)=>{n.d(t,{db:()=>s,_:()=>r});let a=require("@prisma/client"),r=globalThis.prisma??new a.PrismaClient,s=r}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),a=t.X(0,[5923,7146],()=>n(4304));module.exports=a})();