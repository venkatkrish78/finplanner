"use strict";(()=>{var e={};e.id=5554,e.ids=[5554],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},279:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>g,patchFetch:()=>M,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var r={};a.r(r),a.d(r,{GET:()=>l,dynamic:()=>d});var n=a(921),o=a(7380),i=a(4185),u=a(3878),s=a(9958);let d="force-dynamic";async function l(e,{params:t}){try{let e=await s._.loan.findUnique({where:{id:t.id},include:{payments:{orderBy:{paymentDate:"asc"}}}});if(!e)return u.NextResponse.json({error:"Loan not found"},{status:404});let a=e.principalAmount,r=e.interestRate/100/12,n=e.tenure,o=e.emiAmount,i=[],d=a,l=0,p=new Map;e.payments.forEach(t=>{let a=Math.floor((t.paymentDate.getTime()-e.startDate.getTime())/2592e6)+1;p.has(a)||p.set(a,[]),p.get(a).push(t)});for(let e=1;e<=n&&d>0;e++){let t=d*r,a=Math.min(o-t,d),n=p.get(e)||[],u=n.reduce((e,t)=>e+t.amount,0),s=n.reduce((e,t)=>e+t.principalPaid,0),c=n.reduce((e,t)=>e+t.interestPaid,0);d=Math.max(0,d-a),l+=t,i.push({month:e,scheduledEmi:Math.round(o),scheduledPrincipal:Math.round(a),scheduledInterest:Math.round(t),scheduledBalance:Math.round(d),actualAmount:Math.round(u),actualPrincipal:Math.round(s),actualInterest:Math.round(c),isPaid:n.length>0,payments:n})}return u.NextResponse.json({loan:e,schedule:i,summary:{totalScheduledAmount:Math.round(o*n),totalScheduledInterest:Math.round(l),remainingBalance:Math.round(e.currentBalance),completionPercentage:Math.round((a-e.currentBalance)/a*100)}})}catch(e){return console.error("Error generating amortization schedule:",e),u.NextResponse.json({error:"Failed to generate amortization schedule"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/loans/amortization/[id]/route",pathname:"/api/loans/amortization/[id]",filename:"route",bundlePath:"app/api/loans/amortization/[id]/route"},resolvedPagePath:"/home/ubuntu/moneymitra/app/app/api/loans/amortization/[id]/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:h}=p,g="/api/loans/amortization/[id]/route";function M(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},9958:(e,t,a)=>{a.d(t,{_:()=>n,db:()=>o});var r=a(3524);let n=globalThis.prisma??new r.PrismaClient,o=n}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[5923,7146],()=>a(279));module.exports=r})();