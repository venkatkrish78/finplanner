"use strict";(()=>{var e={};e.id=1396,e.ids=[1396],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4303:(e,a,t)=>{t.r(a),t.d(a,{originalPathname:()=>h,patchFetch:()=>w,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>y,staticGenerationAsyncStorage:()=>m});var n={};t.r(n),t.d(n,{POST:()=>l,dynamic:()=>u});var r=t(921),o=t(7380),i=t(4185),s=t(3878),p=t(9958);let u="force-dynamic";async function l(e){try{let{loanId:a,amount:t,paymentType:n,note:r,createTransaction:o}=await e.json(),i=await p._.$transaction(async e=>{let i=await e.loan.findUnique({where:{id:a}});if(!i)throw Error("Loan not found");let s=parseFloat(t),p=i.interestRate/100/12,u=i.currentBalance*p,l=Math.max(0,s-u),d=await e.loanPayment.create({data:{loanId:a,amount:s,paymentType:n,principalPaid:l,interestPaid:Math.min(u,s),note:r,paymentDate:new Date}}),c=Math.max(0,i.currentBalance-l);await e.loan.update({where:{id:a},data:{currentBalance:c}});let m=null;if(o){let a=await e.category.findFirst({where:{name:"Loan Payment"}});a||(a=await e.category.create({data:{name:"Loan Payment",color:"#EF4444",isDefault:!0}})),m=await e.transaction.create({data:{amount:s,type:"EXPENSE",description:`Loan payment: ${i.name}`,date:new Date,categoryId:a.id,source:"MANUAL"}}),await e.loanPayment.update({where:{id:d.id},data:{transactionId:m.id}})}return{payment:d,loan:{...i,currentBalance:c},transaction:m}});return s.NextResponse.json(i,{status:201})}catch(e){return console.error("Error creating loan payment:",e),s.NextResponse.json({error:"Failed to create loan payment"},{status:500})}}let d=new r.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/loans/payments/route",pathname:"/api/loans/payments",filename:"route",bundlePath:"app/api/loans/payments/route"},resolvedPagePath:"/home/ubuntu/moneymitra/app/app/api/loans/payments/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:y}=d,h="/api/loans/payments/route";function w(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:m})}},9958:(e,a,t)=>{t.d(a,{_:()=>r,db:()=>o});var n=t(3524);let r=globalThis.prisma??new n.PrismaClient,o=r}};var a=require("../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),n=a.X(0,[5923,7146],()=>t(4303));module.exports=n})();