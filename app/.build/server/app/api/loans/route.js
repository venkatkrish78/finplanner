"use strict";(()=>{var e={};e.id=6397,e.ids=[6397],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4058:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y});var a={};r.r(a),r.d(a,{GET:()=>u,POST:()=>c,dynamic:()=>l});var n=r(3277),o=r(5265),s=r(5356),i=r(7076),p=r(6059);let l="force-dynamic";async function u(e){try{let{searchParams:t}=new URL(e.url),r=t.get("type"),a={};r&&(a.loanType=r);let n=await p._.loan.findMany({where:a,include:{category:!0,payments:{orderBy:{paymentDate:"desc"},take:5}},orderBy:{createdAt:"desc"}});return i.NextResponse.json(n)}catch(e){return console.error("Error fetching loans:",e),i.NextResponse.json({error:"Failed to fetch loans"},{status:500})}}async function c(e){try{let{name:t,loanType:r,principalAmount:a,interestRate:n,tenure:o,startDate:s,description:l,categoryId:u}=await e.json(),c=parseFloat(a),d=parseFloat(n)/100/12,m=parseInt(o),y=d>0?c*d*Math.pow(1+d,m)/(Math.pow(1+d,m)-1):c/m,h=new Date(s);h.setMonth(h.getMonth()+m);let g=await p._.loan.create({data:{name:t,loanType:r,principalAmount:c,currentBalance:c,interestRate:parseFloat(n),emiAmount:y,tenure:m,startDate:new Date(s),endDate:h,description:l,categoryId:u||null},include:{category:!0,payments:!0}});return i.NextResponse.json(g,{status:201})}catch(e){return console.error("Error creating loan:",e),i.NextResponse.json({error:"Failed to create loan"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/loans/route",pathname:"/api/loans",filename:"route",bundlePath:"app/api/loans/route"},resolvedPagePath:"/home/ubuntu/moneymitra/app/app/api/loans/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:y,serverHooks:h}=d,g="/api/loans/route";function x(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}},6059:(e,t,r)=>{r.d(t,{_:()=>n,db:()=>o});var a=r(3524);let n=globalThis.prisma??new a.PrismaClient,o=n}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[5942,3786],()=>r(4058));module.exports=a})();