"use strict";(()=>{var e={};e.id=8866,e.ids=[8866],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8441:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>b,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>y,staticGenerationAsyncStorage:()=>g});var n={};a.r(n),a.d(n,{GET:()=>d,POST:()=>u,dynamic:()=>l});var r=a(3277),s=a(5265),o=a(5356),i=a(7076),c=a(6059);let l="force-dynamic";async function d(e){try{let{searchParams:t}=new URL(e.url),a=parseInt(t.get("page")||"1"),n=parseInt(t.get("limit")||"50"),r=t.get("type"),s=t.get("categoryId"),o=t.get("startDate"),l=t.get("endDate"),d=t.get("search"),u=t.get("sortBy")||"date",p=t.get("sortOrder")||"desc",m=t.get("year"),g=t.get("month"),y={};if(m){let e=parseInt(m);if(g){let t=parseInt(g),a=new Date(e,t-1,1),n=new Date(e,t,0,23,59,59);y={gte:a,lte:n}}else{let t=new Date(e,0,1),a=new Date(e,11,31,23,59,59);y={gte:t,lte:a}}}else(o||l)&&(o&&(y.gte=new Date(o)),l&&(y.lte=new Date(l)));let h={};Object.keys(y).length>0&&(h.date=y),r&&"all"!==r&&(h.type=r),s&&"all"!==s&&(h.categoryId=s),d&&(h.OR=[{description:{contains:d,mode:"insensitive"}},{merchant:{contains:d,mode:"insensitive"}}]);let[b,w,I,f]=await Promise.all([c._.transaction.findMany({where:h,include:{category:!0}}),c._.billInstance.findMany({where:{...Object.keys(y).length>0&&{paidDate:y},status:"PAID"},include:{bill:{include:{category:!0}},transaction:!0}}),c._.loanPayment.findMany({where:{...Object.keys(y).length>0&&{paymentDate:y}},include:{loan:{include:{category:!0}},transaction:!0}}),c._.investmentTransaction.findMany({where:{...Object.keys(y).length>0&&{date:y},type:{in:["BUY","SELL"]}},include:{investment:{include:{category:!0}},transaction:!0}})]),E=[...b];w.forEach(e=>{if(!e.transaction){let t={id:`bill-${e.id}`,amount:e.amount,type:"EXPENSE",description:`Bill payment: ${e.bill.name}`,merchant:e.bill.name,date:e.paidDate,category:e.bill.category,categoryId:e.bill.categoryId,status:"SUCCESS",source:"BILL",transactionId:`BILL-${e.id}`,accountNumber:null,balance:null,rawMessage:null,createdAt:e.createdAt,updatedAt:e.updatedAt};E.push(t)}}),I.forEach(e=>{if(!e.transaction){let t={id:`loan-${e.id}`,amount:e.amount,type:"EXPENSE",description:`Loan payment: ${e.loan.name}`,merchant:e.loan.name,date:e.paymentDate,category:e.loan.category,categoryId:e.loan.categoryId,status:"SUCCESS",source:"LOAN",transactionId:`LOAN-${e.id}`,accountNumber:null,balance:null,rawMessage:null,createdAt:e.createdAt,updatedAt:e.createdAt};E.push(t)}}),f.forEach(e=>{if(!e.transaction){let t={id:`investment-${e.id}`,amount:e.amount,type:"BUY"===e.type?"EXPENSE":"INCOME",description:`Investment ${e.type.toLowerCase()}: ${e.investment.name}`,merchant:e.investment.name,date:e.date,category:e.investment.category,categoryId:e.investment.categoryId,status:"SUCCESS",source:"INVESTMENT",transactionId:`INV-${e.id}`,accountNumber:null,balance:null,rawMessage:null,createdAt:e.createdAt,updatedAt:e.updatedAt};E.push(t)}});let A=E;if(r&&"all"!==r&&(A=A.filter(e=>e.type===r)),s&&"all"!==s&&(A=A.filter(e=>e.categoryId===s)),d){let e=d.toLowerCase();A=A.filter(t=>t.description&&t.description.toLowerCase().includes(e)||t.merchant&&t.merchant.toLowerCase().includes(e))}A.sort((e,t)=>{let a,n;switch(u){case"amount":a=e.amount,n=t.amount;break;case"description":a=e.description||"",n=t.description||"";break;case"category":a=e.category?.name||"",n=t.category?.name||"";break;case"merchant":a=e.merchant||"",n=t.merchant||"";break;default:a=new Date(e.date),n=new Date(t.date)}return"desc"===p?a>n?-1:a<n?1:0:a<n?-1:a>n?1:0});let v=A.length,S=(a-1)*n,N=A.slice(S,S+n);return i.NextResponse.json({transactions:N,pagination:{page:a,limit:n,total:v,pages:Math.ceil(v/n)}})}catch(e){return console.error("Error fetching transactions:",e),i.NextResponse.json({error:"Failed to fetch transactions"},{status:500})}}async function u(e){try{let t=await e.json(),a=await c._.transaction.create({data:{amount:t.amount,type:t.type,description:t.description,merchant:t.merchant,accountNumber:t.accountNumber,transactionId:t.transactionId,date:new Date(t.date),balance:t.balance,status:t.status||"SUCCESS",source:t.source||"MANUAL",rawMessage:t.rawMessage,categoryId:t.categoryId},include:{category:!0}});return i.NextResponse.json(a)}catch(e){return console.error("Error creating transaction:",e),i.NextResponse.json({error:"Failed to create transaction"},{status:500})}}let p=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/transactions/route",pathname:"/api/transactions",filename:"route",bundlePath:"app/api/transactions/route"},resolvedPagePath:"/home/ubuntu/moneymitra/app/app/api/transactions/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:y}=p,h="/api/transactions/route";function b(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:g})}},6059:(e,t,a)=>{a.d(t,{_:()=>r,db:()=>s});var n=a(3524);let r=globalThis.prisma??new n.PrismaClient,s=r}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[5942,3786],()=>a(8441));module.exports=n})();