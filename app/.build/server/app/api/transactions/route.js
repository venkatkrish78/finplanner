"use strict";(()=>{var e={};e.id=8866,e.ids=[8866],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},409:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>w,requestAsyncStorage:()=>g,routeModule:()=>l,serverHooks:()=>y,staticGenerationAsyncStorage:()=>m});var r={};a.r(r),a.d(r,{GET:()=>d,POST:()=>p,dynamic:()=>u});var n=a(921),s=a(7380),o=a(4185),i=a(3878),c=a(9958);let u="force-dynamic";async function d(e){try{let{searchParams:t}=new URL(e.url),a=parseInt(t.get("page")||"1"),r=parseInt(t.get("limit")||"50"),n=t.get("type"),s=t.get("categoryId"),o=t.get("startDate"),u=t.get("endDate"),d=t.get("search"),p=t.get("sortBy")||"date",l=t.get("sortOrder")||"desc",g=t.get("year"),m=t.get("month"),y=(a-1)*r,h={};if(n&&"all"!==n&&(h.type=n),s&&"all"!==s&&(h.categoryId=s),g){let e=parseInt(g);if(m){let t=parseInt(m),a=new Date(e,t-1,1),r=new Date(e,t,0,23,59,59);h.date={gte:a,lte:r}}else{let t=new Date(e,0,1),a=new Date(e,11,31,23,59,59);h.date={gte:t,lte:a}}}else(o||u)&&(h.date={},o&&(h.date.gte=new Date(o)),u&&(h.date.lte=new Date(u)));d&&(h.OR=[{description:{contains:d,mode:"insensitive"}},{merchant:{contains:d,mode:"insensitive"}}]);let w={};switch(p){case"amount":w.amount=l;break;case"description":w.description=l;break;case"category":w.category={name:l};break;case"merchant":w.merchant=l;break;default:w.date=l}let[x,b]=await Promise.all([c._.transaction.findMany({where:h,include:{category:!0},orderBy:w,skip:y,take:r}),c._.transaction.count({where:h})]);return i.NextResponse.json({transactions:x,pagination:{page:a,limit:r,total:b,pages:Math.ceil(b/r)}})}catch(e){return console.error("Error fetching transactions:",e),i.NextResponse.json({error:"Failed to fetch transactions"},{status:500})}}async function p(e){try{let t=await e.json(),a=await c._.transaction.create({data:{amount:t.amount,type:t.type,description:t.description,merchant:t.merchant,accountNumber:t.accountNumber,transactionId:t.transactionId,date:new Date(t.date),balance:t.balance,status:t.status||"SUCCESS",source:t.source||"MANUAL",rawMessage:t.rawMessage,categoryId:t.categoryId},include:{category:!0}});return i.NextResponse.json(a)}catch(e){return console.error("Error creating transaction:",e),i.NextResponse.json({error:"Failed to create transaction"},{status:500})}}let l=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/transactions/route",pathname:"/api/transactions",filename:"route",bundlePath:"app/api/transactions/route"},resolvedPagePath:"/home/ubuntu/moneymitra/app/app/api/transactions/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:m,serverHooks:y}=l,h="/api/transactions/route";function w(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:m})}},9958:(e,t,a)=>{a.d(t,{_:()=>n,db:()=>s});var r=a(3524);let n=globalThis.prisma??new r.PrismaClient,s=n}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[5923,7146],()=>a(409));module.exports=r})();