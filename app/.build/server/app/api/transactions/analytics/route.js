"use strict";(()=>{var t={};t.id=2120,t.ids=[2120],t.modules={3524:t=>{t.exports=require("@prisma/client")},399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8123:(t,e,a)=>{a.r(e),a.d(e,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>y,staticGenerationAsyncStorage:()=>p});var n={};a.r(n),a.d(n,{GET:()=>u,dynamic:()=>l});var o=a(921),r=a(7380),i=a(4185),c=a(3878),s=a(9958);let l="force-dynamic";async function u(t){try{let{searchParams:e}=new URL(t.url),a=parseInt(e.get("year")||new Date().getFullYear().toString()),n=e.get("month"),o=n?parseInt(n):null,r=new Date(a,0,1),i=new Date(a,11,31,23,59,59),l=[];for(let t=1;t<=12;t++){let e=new Date(a,t-1,1),n=new Date(a,t,0,23,59,59),[o,r,i,c,u]=await Promise.all([s._.transaction.aggregate({where:{date:{gte:e,lte:n},type:"INCOME"},_sum:{amount:!0},_count:!0}),s._.transaction.aggregate({where:{date:{gte:e,lte:n},type:"EXPENSE"},_sum:{amount:!0},_count:!0}),s._.billInstance.findMany({where:{paidDate:{gte:e,lte:n},status:"PAID"},include:{transaction:!0}}),s._.loanPayment.findMany({where:{paymentDate:{gte:e,lte:n}},include:{transaction:!0}}),s._.investmentTransaction.findMany({where:{date:{gte:e,lte:n},type:{in:["BUY","SELL"]}},include:{transaction:!0}})]),d=0,m=0,p=0;u.forEach(t=>{"SELL"!==t.type||t.transaction?"BUY"===t.type&&!t.transaction&&(m+=t.amount,p++):(d+=t.amount,p++)}),i.forEach(t=>{!t.transaction&&(m+=t.amount,p++)}),c.forEach(t=>{!t.transaction&&(m+=t.amount,p++)}),l.push({month:t,year:a,income:(o._sum.amount||0)+d,expense:(r._sum.amount||0)+m,transaction_count:o._count+r._count+p})}let u={date:{gte:r,lte:i}};if(o){let t=new Date(a,o-1,1),e=new Date(a,o,0,23,59,59);u={date:{gte:t,lte:e}}}let d=await s._.transaction.findMany({where:u,include:{category:!0}}),[m,p,y]=await Promise.all([s._.billInstance.findMany({where:{paidDate:u.date,status:"PAID"},include:{bill:{include:{category:!0}},transaction:!0}}),s._.loanPayment.findMany({where:{paymentDate:u.date},include:{loan:{include:{category:!0}},transaction:!0}}),s._.investmentTransaction.findMany({where:{date:u.date,type:{in:["BUY","SELL"]}},include:{investment:{include:{category:!0}},transaction:!0}})]),g=[...d];m.forEach(t=>{t.transaction||g.push({id:`bill-${t.id}`,amount:t.amount,type:"EXPENSE",description:`Bill payment: ${t.bill.name}`,date:t.paidDate,category:t.bill.category,categoryId:t.bill.categoryId})}),p.forEach(t=>{t.transaction||g.push({id:`loan-${t.id}`,amount:t.amount,type:"EXPENSE",description:`Loan payment: ${t.loan.name}`,date:t.paymentDate,category:t.loan.category,categoryId:t.loan.categoryId})}),y.forEach(t=>{t.transaction||g.push({id:`investment-${t.id}`,amount:t.amount,type:"BUY"===t.type?"EXPENSE":"INCOME",description:`Investment ${t.type.toLowerCase()}: ${t.investment.name}`,date:t.date,category:t.investment.category,categoryId:t.investment.categoryId})});let h=g.reduce((t,e)=>{e.category?.name,e.type;let a=t.find(t=>t.category_name===(e.category?.name||"Uncategorized")&&t.transaction_type===e.type);return a?(a.total_amount+=e.amount,a.transaction_count+=1):t.push({category_name:e.category?.name||"Uncategorized",category_color:e.category?.color||"#3B82F6",transaction_type:e.type,total_amount:e.amount,transaction_count:1}),t},[]),_=null;if(o){let t=l.find(t=>t.month===o);if(t){let e=g.filter(t=>{let e=new Date(t.date);return e.getFullYear()===a&&e.getMonth()===o-1}),n=e.filter(t=>"INCOME"===t.type).length,r=e.filter(t=>"EXPENSE"===t.type).length;_={total_income:t.income,total_expense:t.expense,total_transactions:t.transaction_count,income_count:n,expense_count:r}}}let E=l.reduce((t,e)=>t+e.income,0),f=l.reduce((t,e)=>t+e.expense,0),w=l.reduce((t,e)=>t+e.transaction_count,0),x=g.filter(t=>"INCOME"===t.type).length,P=g.filter(t=>"EXPENSE"===t.type).length;return c.NextResponse.json({monthlyTrends:l||[],categoryBreakdown:h||[],monthlySummary:_||null,yearlySummary:{total_income:E,total_expense:f,total_transactions:w,income_count:x,expense_count:P},year:a,month:o})}catch(t){return console.error("Error fetching transaction analytics:",t),c.NextResponse.json({error:"Failed to fetch transaction analytics"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/transactions/analytics/route",pathname:"/api/transactions/analytics",filename:"route",bundlePath:"app/api/transactions/analytics/route"},resolvedPagePath:"/home/ubuntu/moneymitra/app/app/api/transactions/analytics/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:p,serverHooks:y}=d,g="/api/transactions/analytics/route";function h(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:p})}},9958:(t,e,a)=>{a.d(e,{_:()=>o,db:()=>r});var n=a(3524);let o=globalThis.prisma??new n.PrismaClient,r=o}};var e=require("../../../../webpack-runtime.js");e.C(t);var a=t=>e(e.s=t),n=e.X(0,[5923,7146],()=>a(8123));module.exports=n})();