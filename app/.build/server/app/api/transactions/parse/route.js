"use strict";(()=>{var e={};e.id=2160,e.ids=[2160],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8562:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>b,patchFetch:()=>v,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>g,staticGenerationAsyncStorage:()=>D});var i={};n.r(i),n.d(i,{POST:()=>p,dynamic:()=>m});var a=n(921),s=n(7380),r=n(4185),c=n(3878);class l{parse(e){try{let t=e.trim(),n=this.identifyPlatform(t),i=this.extractAmount(t,n);if(!i)return null;let a=this.extractTransactionType(t),s=this.extractAccountNumber(t,n),r=this.extractTransactionId(t),c=this.extractDate(t),l=this.extractBalance(t,n),o=this.extractStatus(t),u=this.extractMerchant(t);return{amount:i,type:a,description:this.generateDescription(t,u,n),merchant:u,accountNumber:s,transactionId:r,date:c||new Date,balance:l,status:o||"SUCCESS",platform:n}}catch(e){return console.error("Error parsing transaction:",e),null}}identifyPlatform(e){let t=e.match(this.patterns.platform);return t?t[1].trim():void 0}extractAmount(e,t){if(t&&this.bankSpecificPatterns[t]){let n=this.bankSpecificPatterns[t];if("amount"in n&&n.amount){let t=e.match(n.amount);if(t)return parseFloat(t[1].replace(/,/g,""))}}let n=e.match(this.patterns.amount);return n?parseFloat(n[1].replace(/,/g,"")):null}extractTransactionType(e){let t=e.match(this.patterns.transactionType);if(t){let e=t[1].toLowerCase();if("credited"===e||"received"===e)return"INCOME";if("debited"===e||"paid"===e);else if("transferred"===e)return"TRANSFER"}return"EXPENSE"}extractAccountNumber(e,t){if(t&&this.bankSpecificPatterns[t]){let n=this.bankSpecificPatterns[t];if("account"in n&&n.account){let t=e.match(n.account);if(t)return t[1]}}let n=e.match(this.patterns.account);return n?n[1]:void 0}extractTransactionId(e){let t=e.match(this.patterns.transactionId);return t?t[1]:void 0}extractDate(e){for(let t of this.patterns.dateTime){let n=e.match(t);if(n)try{if(!n[2])return new Date(n[1]);{let e=n[1],t=n[2],[i,a,s]=e.split("-").map(Number),[r,c,l=0]=t.split(":").map(Number),o=s<100?2e3+s:s;return new Date(o,a-1,i,r,c,l)}}catch(e){continue}}return null}extractBalance(e,t){if(t&&this.bankSpecificPatterns[t]){let n=this.bankSpecificPatterns[t];if("balance"in n&&n.balance){let t=e.match(n.balance);if(t)return parseFloat(t[1].replace(/,/g,""))}}let n=e.match(this.patterns.balance);if(n)return parseFloat(n[1].replace(/,/g,""))}extractStatus(e){let t=e.match(this.patterns.status);if(t){let e=t[1].toLowerCase();if("success"===e)return"SUCCESS";if("failed"===e)return"FAILED";if("pending"===e)return"PENDING"}}extractMerchant(e){let t=e.match(this.patterns.merchant);return t?t[1].trim():void 0}generateDescription(e,t,n){return t?`Payment to ${t}`:n?`${n} transaction`:e.split(" ").slice(0,10).join(" ")+(e.split(" ").length>10?"...":"")}constructor(){this.patterns={amount:/(?:Rs\.?\s*|INR\s*|₹\s*)(\d+(?:,\d{3})*(?:\.\d{2})?)/i,transactionType:/(debited|credited|transferred|paid|received)/i,account:/(?:A\/c|account|card).*?(?:ending|no\.?)\s*(?:XX)?(\d{4,6})/i,dateTime:[/(\d{2}-\d{2}-\d{2,4})\s+(\d{2}:\d{2}(?::\d{2})?)/,/(\d{1,2}\/\d{1,2}\/\d{4})/,/(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})/],transactionId:/(?:Txn\s*ID|Transaction\s*ID|Ref\s*No|UPI\s*Ref):\s*([A-Z0-9]+)/i,balance:/(?:Avl\s*Bal|Available\s*Balance|Balance)[-:\s]*(?:Rs\.?\s*|INR\s*|₹\s*)(\d+(?:,\d{3})*(?:\.\d{2})?)/i,platform:/^(SBI|HDFC|ICICI|Axis|PhonePe|Paytm|GPay|Amazon\s*Pay|BHIM|UPI)/i,status:/Status:\s*(Success|Failed|Pending)/i,merchant:/(?:at|from|to)\s+([A-Z\s]+?)(?:\s+on|\s+Txn|\s+UPI|\.)/i},this.bankSpecificPatterns={SBI:{amount:/INR\s*(\d+(?:\.\d{2})?)/i,account:/A\/c no\.\s*XX(\d{4})/i,balance:/Avl Bal-\s*INR\s*(\d+(?:\.\d{2})?)/i},HDFC:{amount:/Rs\.\s*(\d+(?:\.\d{2})?)/i,account:/A\/c ending\s*(\d{4})/i},ICICI:{account:/(\d{6})$/i},UPI:{amount:/Rs\.\s*(\d+(?:\.\d{2})?)/i,account:/(?:account|A\/c) ending\s*(\d{4})/i}}}}let o=new l;var u=n(5871),d=n(2334);let m="force-dynamic";async function p(e){try{let{messageText:t}=await e.json();if(!t)return c.NextResponse.json({error:"Message text is required"},{status:400});let n=o.parse(t);if(!n)return c.NextResponse.json({error:"Could not parse transaction from the provided text"},{status:400});let i=(0,u.SQ)(n.description||"",n.merchant),a=await d._.category.findFirst({where:{name:i}}),s=await d._.category.findFirst({where:{name:"Others"}}),r=a?.id||s?.id;if(!r)return c.NextResponse.json({error:"No categories found. Please seed default categories first."},{status:400});return c.NextResponse.json({...n,categoryId:r,suggestedCategory:a?.name||"Others",rawMessage:t})}catch(e){return console.error("Error parsing transaction:",e),c.NextResponse.json({error:"Failed to parse transaction"},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/transactions/parse/route",pathname:"/api/transactions/parse",filename:"route",bundlePath:"app/api/transactions/parse/route"},resolvedPagePath:"/home/ubuntu/moneymitra/app/app/api/transactions/parse/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:h,staticGenerationAsyncStorage:D,serverHooks:g}=f,b="/api/transactions/parse/route";function v(){return(0,r.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:D})}},5871:(e,t,n)=>{n.d(t,{D$:()=>i,SQ:()=>a});let i=[{name:"Food & Dining",color:"#EF4444",isDefault:!0},{name:"Transportation",color:"#3B82F6",isDefault:!0},{name:"Bills & Utilities",color:"#F59E0B",isDefault:!0},{name:"Entertainment",color:"#8B5CF6",isDefault:!0},{name:"Shopping",color:"#EC4899",isDefault:!0},{name:"Healthcare",color:"#10B981",isDefault:!0},{name:"Education",color:"#6366F1",isDefault:!0},{name:"Investment",color:"#059669",isDefault:!0},{name:"Groceries",color:"#84CC16",isDefault:!0},{name:"Fuel",color:"#F97316",isDefault:!0},{name:"Insurance",color:"#0EA5E9",isDefault:!0},{name:"Salary",color:"#22C55E",isDefault:!0},{name:"Business",color:"#A855F7",isDefault:!0},{name:"Rent",color:"#DC2626",isDefault:!0},{name:"Electricity",color:"#FBBF24",isDefault:!0},{name:"Water",color:"#06B6D4",isDefault:!0},{name:"Gas",color:"#F97316",isDefault:!0},{name:"Internet & Phone",color:"#8B5CF6",isDefault:!0},{name:"Subscriptions",color:"#EC4899",isDefault:!0},{name:"Loan EMI",color:"#EF4444",isDefault:!0},{name:"Credit Card",color:"#6366F1",isDefault:!0},{name:"Maintenance",color:"#64748B",isDefault:!0},{name:"Savings",color:"#10B981",isDefault:!0},{name:"Loan Payment",color:"#EF4444",isDefault:!0},{name:"Goal Contribution",color:"#3B82F6",isDefault:!0},{name:"Stock Investment",color:"#059669",isDefault:!0},{name:"Mutual Fund",color:"#0D9488",isDefault:!0},{name:"SIP Investment",color:"#0891B2",isDefault:!0},{name:"Crypto Investment",color:"#7C3AED",isDefault:!0},{name:"Gold Investment",color:"#D97706",isDefault:!0},{name:"Real Estate",color:"#DC2626",isDefault:!0},{name:"PPF/EPF",color:"#16A34A",isDefault:!0},{name:"Fixed Deposit",color:"#2563EB",isDefault:!0},{name:"Investment Dividend",color:"#059669",isDefault:!0},{name:"Investment Sale",color:"#DC2626",isDefault:!0},{name:"Brokerage Fees",color:"#6B7280",isDefault:!0},{name:"Others",color:"#6B7280",isDefault:!0}];function a(e,t){let n=(e+" "+(t||"")).toLowerCase();return n.includes("restaurant")||n.includes("food")||n.includes("cafe")||n.includes("zomato")||n.includes("swiggy")||n.includes("dominos")||n.includes("mcdonald")||n.includes("kfc")||n.includes("pizza")?"Food & Dining":n.includes("uber")||n.includes("ola")||n.includes("metro")||n.includes("bus")||n.includes("taxi")||n.includes("auto")||n.includes("petrol")||n.includes("diesel")||n.includes("fuel")?"Transportation":n.includes("electricity")||n.includes("water")||n.includes("gas")||n.includes("internet")||n.includes("broadband")||n.includes("mobile")||n.includes("recharge")||n.includes("bill")||n.includes("utility")?"Bills & Utilities":n.includes("movie")||n.includes("netflix")||n.includes("amazon prime")||n.includes("hotstar")||n.includes("spotify")||n.includes("game")||n.includes("entertainment")||n.includes("cinema")?"Entertainment":n.includes("amazon")||n.includes("flipkart")||n.includes("myntra")||n.includes("shopping")||n.includes("mall")||n.includes("store")||n.includes("purchase")||n.includes("buy")?"Shopping":n.includes("hospital")||n.includes("doctor")||n.includes("medical")||n.includes("pharmacy")||n.includes("medicine")||n.includes("health")||n.includes("clinic")||n.includes("apollo")||n.includes("fortis")?"Healthcare":n.includes("grocery")||n.includes("supermarket")||n.includes("bigbasket")||n.includes("grofers")||n.includes("vegetables")||n.includes("fruits")||n.includes("milk")||n.includes("bread")?"Groceries":n.includes("mutual fund")||n.includes("mf")||n.includes("sip")?"Mutual Fund":n.includes("stock")||n.includes("equity")||n.includes("share")||n.includes("nse")||n.includes("bse")?"Stock Investment":n.includes("crypto")||n.includes("bitcoin")||n.includes("ethereum")||n.includes("binance")||n.includes("wazirx")?"Crypto Investment":n.includes("gold")||n.includes("silver")||n.includes("precious metal")?"Gold Investment":n.includes("ppf")||n.includes("epf")||n.includes("provident fund")?"PPF/EPF":n.includes("fd")||n.includes("fixed deposit")||n.includes("rd")||n.includes("recurring deposit")?"Fixed Deposit":n.includes("dividend")||n.includes("interest earned")?"Investment Dividend":n.includes("brokerage")||n.includes("commission")||n.includes("charges")?"Brokerage Fees":n.includes("investment")||n.includes("zerodha")||n.includes("groww")||n.includes("upstox")||n.includes("angel one")||n.includes("kuvera")?"Investment":n.includes("salary")||n.includes("credited")||n.includes("income")||n.includes("bonus")||n.includes("allowance")?"Salary":"Others"}},2334:(e,t,n)=>{n.d(t,{db:()=>s,_:()=>a});let i=require("@prisma/client"),a=globalThis.prisma??new i.PrismaClient,s=a}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),i=t.X(0,[5923,7146],()=>n(8562));module.exports=i})();