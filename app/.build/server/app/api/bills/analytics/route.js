"use strict";(()=>{var e={};e.id=7587,e.ids=[7587],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6355:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>y,patchFetch:()=>h,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var r={};a.r(r),a.d(r,{GET:()=>c,dynamic:()=>u});var n=a(3277),o=a(5265),i=a(5356),l=a(7076),s=a(6059);let u="force-dynamic";async function c(e){try{let e=new Date,t=new Date;t.setMonth(e.getMonth()-6);let a=(await s._.billInstance.groupBy({by:["dueDate"],where:{status:"PAID",paidDate:{gte:t}},_sum:{amount:!0}})).reduce((e,t)=>{let a=new Date(t.dueDate).toLocaleDateString("en-US",{year:"numeric",month:"short"});return e[a]||(e[a]=0),e[a]+=t._sum.amount||0,e},{}),r=Object.entries(a).map(([e,t])=>({month:e,amount:t})),n=new Date(e.getFullYear(),e.getMonth(),1),o=new Date(e.getFullYear(),e.getMonth()+1,0),i=(await s._.billInstance.findMany({where:{status:"PAID",paidDate:{gte:n,lte:o}},include:{bill:{include:{category:!0}}}})).reduce((e,t)=>{let a=t.bill.category.name,r=t.bill.category.color;return e[a]||(e[a]={amount:0,color:r}),e[a].amount+=t.amount,e},{}),u=Object.entries(i).map(([e,t])=>({category:e,amount:t.amount,color:t.color}));return l.NextResponse.json({monthlySpending:r,categoryBreakdown:u})}catch(e){return console.error("Error fetching bill analytics:",e),l.NextResponse.json({error:"Failed to fetch bill analytics"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/bills/analytics/route",pathname:"/api/bills/analytics",filename:"route",bundlePath:"app/api/bills/analytics/route"},resolvedPagePath:"/home/ubuntu/moneymitra/app/app/api/bills/analytics/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:g}=p,y="/api/bills/analytics/route";function h(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},6059:(e,t,a)=>{a.d(t,{_:()=>n,db:()=>o});var r=a(3524);let n=globalThis.prisma??new r.PrismaClient,o=n}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[5942,3786],()=>a(6355));module.exports=r})();