"use strict";(()=>{var e={};e.id=6732,e.ids=[6732],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9199:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>D,requestAsyncStorage:()=>f,routeModule:()=>y,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{GET:()=>d,POST:()=>p,dynamic:()=>u});var n=r(3277),i=r(5265),s=r(5356),o=r(7076),l=r(6059);let u="force-dynamic";async function c(e,t,r,a){let n,i;if("monthly"===t&&a)n=new Date(r,a-1,1),i=new Date(r,a,0,23,59,59);else{if("yearly"!==t)return{isPaid:!1,paidDate:null};n=new Date(r,0,1),i=new Date(r,11,31,23,59,59)}let s=await l._.billInstance.findFirst({where:{billId:e,status:"PAID",paidDate:{gte:n,lte:i}},orderBy:{paidDate:"desc"}});return{isPaid:!!s,paidDate:s?.paidDate||null}}async function d(e){try{let{searchParams:t}=new URL(e.url),r=t.get("active"),a=t.get("view"),n=t.get("year")?parseInt(t.get("year")):new Date().getFullYear(),i=t.get("month")?parseInt(t.get("month")):new Date().getMonth()+1,s=await l._.bill.findMany({where:null!==r?{isActive:"true"===r}:void 0,include:{category:!0,instances:{orderBy:{dueDate:"desc"},take:5}},orderBy:{nextDueDate:"asc"}});if("monthly"===a||"yearly"===a){let e=[];for(let t of s)if(function(e,t,r,a){let n=new Date(e.nextDueDate),i=n.getFullYear(),s=n.getMonth()+1;if("monthly"===t&&a){if("ONE_TIME"===e.frequency)return i===r&&s===a;if("YEARLY"===e.frequency)return s===a;if("MONTHLY"===e.frequency||"WEEKLY"===e.frequency||"QUARTERLY"===e.frequency||"HALF_YEARLY"===e.frequency)return!0}if("yearly"===t){if("ONE_TIME"===e.frequency)return i===r;"YEARLY"===e.frequency||"MONTHLY"===e.frequency||"WEEKLY"===e.frequency||"QUARTERLY"===e.frequency||e.frequency}return!0}(t,a,n,i)){let r=await c(t.id,a,n,i);e.push({...t,isPaid:r.isPaid,paidDate:r.paidDate,viewPeriod:"monthly"===a?`${n}-${i.toString().padStart(2,"0")}`:n.toString()})}return o.NextResponse.json(e)}return o.NextResponse.json(s)}catch(e){return console.error("Error fetching bills:",e),o.NextResponse.json({error:"Failed to fetch bills"},{status:500})}}async function p(e){try{let{name:t,amount:r,frequency:a,description:n,categoryId:i,nextDueDate:s}=await e.json();if(!t||!r||!a||!i||!s)return o.NextResponse.json({error:"Missing required fields"},{status:400});let u=await l._.bill.create({data:{name:t,amount:parseFloat(r),frequency:a,description:n,categoryId:i,nextDueDate:new Date(s),isActive:!0},include:{category:!0}});return await l._.billInstance.create({data:{billId:u.id,dueDate:new Date(s),amount:parseFloat(r)}}),o.NextResponse.json(u,{status:201})}catch(e){return console.error("Error creating bill:",e),o.NextResponse.json({error:"Failed to create bill"},{status:500})}}let y=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/bills/route",pathname:"/api/bills",filename:"route",bundlePath:"app/api/bills/route"},resolvedPagePath:"/home/ubuntu/moneymitra/app/app/api/bills/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:m}=y,h="/api/bills/route";function D(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},6059:(e,t,r)=>{r.d(t,{_:()=>n,db:()=>i});var a=r(3524);let n=globalThis.prisma??new a.PrismaClient,i=n}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[5942,3786],()=>r(9199));module.exports=a})();